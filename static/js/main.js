// Generative AI-style analysis data pools
const phrases = {
    intro: [
        "This open port presents significant security implications.",
        "Exposure of this service increases the attack surface.",
        "The detected service requires immediate attention.",
        "Public exposure of this port is not recommended."
    ],
    risks: [
        "brute-force attacks from automated bots",
        "credential stuffing using leaked databases",
        "exploitation of known software vulnerabilities",
        "man-in-the-middle interception",
        "unauthorized remote access attempts",
        "potential ransomware deployment vector"
    ],
    exploits: [
        "dictionary-based password attacks",
        "version-specific remote code execution",
        "privilege escalation via misconfiguration",
        "session hijacking techniques",
        "zero-day exploitation if unpatched"
    ],
    recommendations: [
        "Restrict access to trusted IP ranges only",
        "Implement strong, unique credentials",
        "Enable multi-factor authentication where possible",
        "Keep the service fully patched and updated",
        "Use encryption for all communications",
        "Monitor logs for suspicious activity",
        "Consider disabling if not strictly required",
        "Deploy intrusion detection systems"
    ],
    notes: [
        "Common target in recent ransomware campaigns",
        "Frequently scanned by threat actors",
        "Version-specific CVEs may apply",
        "High-value target for lateral movement"
    ],
    closing: [
        "Immediate hardening is strongly advised.",
        "Risk mitigation should be prioritized.",
        "Regular security audits recommended.",
        "Exposure should be minimized promptly."
    ]
};

function showDetailedAnalysis(port, service, banner, severity) {
    // Randomly select phrases for variety
    const intro = phrases.intro[Math.floor(Math.random() * phrases.intro.length)];
    const risks = phrases.risks.sort(() => 0.5 - Math.random()).slice(0, 3 + Math.floor(Math.random() * 2));
    const exploits = phrases.exploits.sort(() => 0.5 - Math.random()).slice(0, 2 + Math.floor(Math.random() * 2));
    const recs = phrases.recommendations.sort(() => 0.5 - Math.random()).slice(0, 4 + Math.floor(Math.random() * 3));
    const note = phrases.notes[Math.floor(Math.random() * phrases.notes.length)];
    const closing = phrases.closing[Math.floor(Math.random() * phrases.closing.length)];

    const bannerInfo = banner && banner !== "No banner response" ?
        `<strong>Detected Banner:</strong> ${banner}<br><br>` : "<strong>No version banner captured.</strong><br><br>";

    const analysis = `
        <h3 style="color:var(--accent);margin-bottom:20px;">ðŸ¤– VulnX AI Expert Analysis</h3>
        <strong>Port:</strong> ${port} (${service})<br>
        <strong>Severity:</strong> ${severity}<br><br>
        ${bannerInfo}
        <strong>Security Assessment</strong><br>
        ${intro}<br><br>

        <strong>Primary Risks</strong><br>
        â€¢ ${risks.join('<br>â€¢ ')}<br><br>

        <strong>Common Exploit Scenarios</strong><br>
        â€¢ ${exploits.join('<br>â€¢ ')}<br><br>

        <strong>Expert Recommendations</strong><br>
        â€¢ ${recs.join('<br>â€¢ ')}<br><br>

        <strong>Additional Intelligence</strong><br>
        â€¢ ${note}<br><br>

        <em>${closing}</em><br><br>
        <em>Analysis generated by VulnX Offline AI Engine â€¢ ${new Date().toLocaleString()}</em>
    `;

    // Create modal
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); display: flex; align-items: center;
        justify-content: center; z-index: 9999;
    `;
    modal.onclick = (e) => { if (e.target === modal) modal.remove(); };

    const content = document.createElement('div');
    content.style.cssText = `
        background: var(--bg-card); padding: 30px; border-radius: 12px;
        max-width: 720px; max-height: 85vh; overflow-y: auto;
        border: 1px solid var(--border); color: var(--text-primary);
    `;
    content.innerHTML = analysis + `
        <div style="text-align:center;margin-top:25px;">
            <button onclick="this.closest('div').parentElement.remove()"
                    style="padding:12px 28px; background:var(--accent); color:black; border:none; border-radius:8px; cursor:pointer; font-weight:600;">
                Close Analysis
            </button>
        </div>
    `;

    modal.appendChild(content);
    document.body.appendChild(modal);
}
